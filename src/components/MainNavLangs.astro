---
// IMPORTS
import type { Multi } from "@types";
import { languages } from "@i18n/ui";
import { getRoutes, sanitizeRoutes } from "@i18n/utils";

// ACTIONS
// Get locale
const { locale } = Astro.props;

// Determine current slug from pathname
let currentPath = Astro.url.pathname;

// Get alt base paths for top-level paths that differ across languages
let base: string = "";
let lang_bases: string | Multi
if (
	currentPath.startsWith("/services/") ||
	currentPath.startsWith("/servicios/") ||
	currentPath.startsWith("/palvelut/")
) {
	base = currentPath.split("/")[1];
	lang_bases = getRoutes(base)
}

// Get alt slugs for any other path that differs across languages
const parts = currentPath.split("/");
let slug: string | undefined = parts.pop() || parts.pop();
const routes: Multi | string = getRoutes(slug);

---

<span class="flex items-center justify-center">
	{
		Object.keys(languages).map((l) => (
			<a
				href={sanitizeRoutes(
					typeof routes === "object"
						? currentPath
								.replace(`/${locale}/`, `/${l}/`)
								.replace(`/${slug}/`, `/${routes[l]}/`)
								.replace(`/${slug}`, `/${routes[l]}/`)
						: currentPath
								.replace(base, typeof lang_bases === "object" ? lang_bases[l] : base)
								.replace(`/${locale}/`, `/${l}/`)
								.replace(`/${locale}`, `/${l}/`),
				)}
				aria-label={`Change language to ${l}`}
			>
				<img
					src={`/icons/${l}.svg`}
					alt={`Icon flag for ${l} language.`}
					class="ml-1 w-8 h-8 hover:animate-pulse"
				/>
			</a>
		))
	}
</span>
